<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>IFE_day31</title>
        <!--
        <script>
            window.onload = function (){
                let sourceData = [{
                    product: "手机",
                    region: "华东",
                    sale: [120, 100, 140, 160, 180, 185, 190, 210, 230, 245, 255, 270]
                }, {
                    product: "手机",
                    region: "华北",
                    sale: [80, 70, 90, 110, 130, 145, 150, 160, 170, 185, 190, 200]
                }, {
                    product: "手机",
                    region: "华南",
                    sale: [220, 200, 240, 250, 260, 270, 280, 295, 310, 335, 355, 380]
                }, {
                    product: "笔记本",
                    region: "华东",
                    sale: [50, 60, 80, 110, 30, 20, 70, 30, 420, 30, 20, 20]
                }, {
                    product: "笔记本",
                    region: "华北",
                    sale: [30, 35, 50, 70, 20, 15, 30, 50, 710, 130, 20, 20]
                }, {
                    product: "笔记本",
                    region: "华南",
                    sale: [80, 120, 130, 140, 70, 75, 120, 90, 550, 120, 110, 100]
                }, {
                    product: "智能音箱",
                    region: "华东",
                    sale: [10, 30, 4, 5, 6, 5, 4, 5, 6, 5, 5, 25]
                }, {
                    product: "智能音箱",
                    region: "华北",
                    sale: [15, 50, 15, 15, 12, 11, 11, 12, 12, 14, 12, 40]
                }, {
                    product: "智能音箱",
                    region: "华南",
                    sale: [10, 40, 10, 6, 5, 6, 8, 6, 6, 6, 7, 26]
                }]                
                    
                var regionSelect = document.getElementById('region-select');
                var productSelect = document.getElementById('product-select');
                var tbody = document.getElementById('tbody');
                var tableHead = document.getElementById('row1');
                

                // 获取数据
                function getData(regionValue, productValue){
                    var td_list = [];
                    for(let item of sourceData){
                        if(item.region === regionValue && item.product === productValue){
                            let x_list = [];
                            x_list.push(item.product);
                            x_list.push(item.region);
                            for(let saleValue of item.sale){
                                x_list.push(saleValue);
                            }
                            td_list.push(x_list);
                        }
                    }
                    return td_list;
                }
                
                // 生成表格函数
                function tbodyHTML(regionValue, productValue){
                    // 制作表头
                    var dataHTML = "<tr id='row1'><th>商品</th><th>地区</th>";
                    for(let i = 1; i < 13; i++){
                        dataHTML += '<th>' + i + '月' + '</th>';
                    }
                    dataHTML += "</tr>";
                    // 制作表格内容
                    let list = getData(regionValue, productValue);
                    for(let j = 0; j < list.length; j++){
                        dataHTML += '<tr>';
                        for(let t_data of list[j]){
                            dataHTML += '<td>' + t_data + '</td>';
                        }
                        dataHTML += '</tr>';
                    }
                    return dataHTML;
                }

                // 初始显示内容
                tbody.innerHTML = tbodyHTML(sourceData[0].region, sourceData[0].product);
                
                // 监听选择变换
                regionSelect.onchange = function(){
                    tbody.innerHTML = "";
                    tbody.innerHTML += tbodyHTML(regionSelect.value, productSelect.value);
                }
                productSelect.onchange = function(){
                    tbody.innerHTML = "";
                    tbody.innerHTML += tbodyHTML(regionSelect.value, productSelect.value);
                }
                
            }

        </script>
        -->

        <!--
        <script>
            window.onload = function (){
                let sourceData = [{
                    product: "手机",
                    region: "华东",
                    sale: [120, 100, 140, 160, 180, 185, 190, 210, 230, 245, 255, 270]
                }, {
                    product: "手机",
                    region: "华北",
                    sale: [80, 70, 90, 110, 130, 145, 150, 160, 170, 185, 190, 200]
                }, {
                    product: "手机",
                    region: "华南",
                    sale: [220, 200, 240, 250, 260, 270, 280, 295, 310, 335, 355, 380]
                }, {
                    product: "笔记本",
                    region: "华东",
                    sale: [50, 60, 80, 110, 30, 20, 70, 30, 420, 30, 20, 20]
                }, {
                    product: "笔记本",
                    region: "华北",
                    sale: [30, 35, 50, 70, 20, 15, 30, 50, 710, 130, 20, 20]
                }, {
                    product: "笔记本",
                    region: "华南",
                    sale: [80, 120, 130, 140, 70, 75, 120, 90, 550, 120, 110, 100]
                }, {
                    product: "智能音箱",
                    region: "华东",
                    sale: [10, 30, 4, 5, 6, 5, 4, 5, 6, 5, 5, 25]
                }, {
                    product: "智能音箱",
                    region: "华北",
                    sale: [15, 50, 15, 15, 12, 11, 11, 12, 12, 14, 12, 40]
                }, {
                    product: "智能音箱",
                    region: "华南",
                    sale: [10, 40, 10, 6, 5, 6, 8, 6, 6, 6, 7, 26]
                }]                
                    
                var regionSelect = document.getElementById('region-select');
                var regionCbox = regionSelect.querySelectorAll('input');
                var productSelect = document.getElementById('product-select');
                var productCbox = productSelect.querySelectorAll('input');
                var tbody = document.querySelector('tbody');
                var selectDiv = document.getElementById('selectDiv');
                
                // 获取数据
                function getData( productValue, regionValue){
                    let td_list = [];
                    // 循环原始数据以做判断
                    for(let item of sourceData){
                        // 循环条件一  （维度一）
                        for(let i = 0; i < productValue.length; i++){
                            // 循环条件二  （维度二）
                            for(let j = 0; j < regionValue.length; j++){
                                // 判断条件一二，获取数据（以数组形式传递）
                                if(item.region === productValue[i] && item.product === regionValue[j]){
                                    let x_list = [];
                                    x_list.push(item.product);
                                    x_list.push(item.region);
                                    for(let saleValue of item.sale){
                                        x_list.push(saleValue);
                                    }
                                    td_list.push(x_list);
                                }
                            }
                        }
                            
                    }
                    return td_list;
                }
                
                // 生成表格函数
                function tbodyHTML(productValue, regionValue){
                    // 制作表头
                    var dataHTML = "<tr id='row1'><th>商品</th><th>地区</th>";
                    for(let i = 1; i < 13; i++){
                        dataHTML += '<th>' + i + '月' + '</th>';
                    }
                    dataHTML += "</tr>";
                    // 制作表格内容
                    let list = getData( productValue, regionValue);
                    for(let j = 0; j < list.length; j++){
                        dataHTML += '<tr>';
                        for(let t_data of list[j]){
                            dataHTML += '<td>' + t_data + '</td>';
                        }
                        dataHTML += '</tr>';
                    }
                    return dataHTML;
                }
                
                // 全选按钮的函数
                function selectAll(elements){
                    if(elements[elements.length -1].checked ){
                        for(let i = 0; i < elements.length; i++){
                            elements[i].checked = 'checked';
                            elements[i].disabled = "";
                        }
                    }
                }
                
                // 单个勾选的函数
                function selectOne(element){
                    // 勾选个数
                    let n = 0;
                    for(let i = 0; i < element.length - 1; i++){
                        if(element[i].checked){
                            n++;
                        }
                    }
                    // 只有一个被勾选时，不可取消
                    if(n == 1){
                        for(let i = 0; i < element.length - 1; i++){
                            if(element[i].checked){
                                element[i].disabled = true;
                            }
                        } 
                    }
                    // 当且只有两个被勾选时，全选状态被取消，并且去除其他disabled
                    if(n == 2){
                        element[3].checked = "";
                        for(let i = 0; i < element.length - 1; i++){
                            element[i].disabled = '';
                        }
                    }
                    // 当全部被勾选时，全选按钮被勾起
                    if(n == 3){
                        element[3].checked = "checked";
                    }
                }

                // 绑定点击(勾选)事件
                regionCbox[3].onclick = function(){
                    selectAll(regionCbox);
                }
                productCbox[3].onclick = function(){
                    selectAll(productCbox);
                }
                for(let i = 0; i < regionCbox.length - 1; i++){
                    regionCbox[i].onclick = function(){
                        selectOne(regionCbox);
                    }
                }
                for(let j = 0; j < productCbox.length - 1; j++){
                    productCbox[j].onclick = function(){
                        selectOne(productCbox);
                    }
                }
                
                // 监听点击（勾选）事件，显示表格
                selectDiv.addEventListener('click', function(){    
                    // 获取勾选的值
                    var regionValueList = [];
                    var productValueList = [];
                    for(let item of regionCbox){
                        if(item.checked){
                            regionValueList.push(item.value);
                        }
                    }
                    for(let item of productCbox){
                        if(item.checked){
                            productValueList.push(item.value);
                        }
                    }
                    // 显示表格
                    tbody.innerHTML = "";
                    tbody.innerHTML += tbodyHTML(productValueList, regionValueList);
                });

                // 初始显示表格,初始状态一行只有一个勾选，所以不可取消
                regionCbox[0].checked = "checked";
                regionCbox[0].disabled= true;
                productCbox[0].checked = "checked";
                productCbox[0].disabled = true;
                tbody.innerHTML += tbodyHTML([sourceData[0].product], [sourceData[0].region]);

            }
        </script>
        -->
        <script>
            window.onload = function (){
                let sourceData = [{
                    product: "手机",
                    region: "华东",
                    sale: [120, 100, 140, 160, 180, 185, 190, 210, 230, 245, 255, 270]
                }, {
                    product: "手机",
                    region: "华北",
                    sale: [80, 70, 90, 110, 130, 145, 150, 160, 170, 185, 190, 200]
                }, {
                    product: "手机",
                    region: "华南",
                    sale: [220, 200, 240, 250, 260, 270, 280, 295, 310, 335, 355, 380]
                }, {
                    product: "笔记本",
                    region: "华东",
                    sale: [50, 60, 80, 110, 30, 20, 70, 30, 420, 30, 20, 20]
                }, {
                    product: "笔记本",
                    region: "华北",
                    sale: [30, 35, 50, 70, 20, 15, 30, 50, 710, 130, 20, 20]
                }, {
                    product: "笔记本",
                    region: "华南",
                    sale: [80, 120, 130, 140, 70, 75, 120, 90, 550, 120, 110, 100]
                }, {
                    product: "智能音箱",
                    region: "华东",
                    sale: [10, 30, 4, 5, 6, 5, 4, 5, 6, 5, 5, 25]
                }, {
                    product: "智能音箱",
                    region: "华北",
                    sale: [15, 50, 15, 15, 12, 11, 11, 12, 12, 14, 12, 40]
                }, {
                    product: "智能音箱",
                    region: "华南",
                    sale: [10, 40, 10, 6, 5, 6, 8, 6, 6, 6, 7, 26]
                }]                
                    
                var regionSelect = document.getElementById('region-select');
                var regionCbox = regionSelect.querySelectorAll('input');
                var productSelect = document.getElementById('product-select');
                var productCbox = productSelect.querySelectorAll('input');
                var tbody = document.querySelector('tbody');
                var selectDiv = document.getElementById('selectDiv');
                
                // 获取数据函数
                function getData( productValue, regionValue){
                    let td_list = [];
                    // 循环原始数据以做判断
                    for(let item of sourceData){
                        // 循环条件一  （维度一）
                        for(let i = 0; i < productValue.length; i++){
                            // 循环条件二  （维度二）
                            for(let j = 0; j < regionValue.length; j++){
                                // 判断条件一二，获取数据（以数组形式传递）
                                if(item.product === productValue[i] && item.region === regionValue[j]){
                                    let x_list = [];
                                    if(productValue.length > 1 && regionValue.length == 1){
                                        x_list.push(item.region);
                                        x_list.push(item.product);
                                    }
                                    else{
                                        x_list.push(item.product);
                                        x_list.push(item.region);
                                    }
                                    for(let saleValue of item.sale){
                                        x_list.push(saleValue);
                                    }
                                    td_list.push(x_list);
                                }
                            }
                        }
                            
                    }
                    // 当数据的第一个与上一行或者往上第二行有重复的时候，删除这个数据。为合并第一列相同的数据腾地方。
                    for(let i = 0; i < td_list.length; i++){
                        if((i > 0 && td_list[i][0] == td_list[i-1][0]) ||(i > 1 && td_list[i][0] == td_list[i-2][0])){
                            td_list[i].shift();
                        }
                    }
                    return td_list;
                }
                
                // 生成表格函数
                function tbodyHTML(productValue, regionValue){
                    // 制作表头
                    // 当地区选择了一个，商品选择了多个的时候，地区作为第一列，商品作为第二列
                    if(productValue.length > 1 && regionValue.length == 1){
                        var dataHTML = "<tr id='row1'><th>地区</th><th>商品</th>";
                    }
                    // 其他情况商品作为第一列，地区作为第二列。
                    else{
                        var dataHTML = "<tr id='row1'><th>商品</th><th>地区</th>";
                    }
                    for(let i = 1; i < 13; i++){
                        dataHTML += '<th>' + i + '月' + '</th>';
                    }
                    dataHTML += "</tr>";
                    // 制作表格内容
                    let list = getData( productValue, regionValue);
                    for(let j = 0; j < list.length; j++){
                        dataHTML += '<tr class = "trData">';
                        for(let t_data of list[j]){
                            dataHTML += '<td>' + t_data + '</td>';
                        }
                        dataHTML += '</tr>';
                    }
                    return dataHTML;
                }
                
                // 全选checkbox的函数
                function selectAll(elements){
                    if(elements[elements.length -1].checked ){
                        for(let i = 0; i < elements.length; i++){
                            elements[i].checked = 'checked';
                            elements[i].disabled = "";
                        }
                    }
                }
                
                // 单个勾选的函数
                function selectOne(element){
                    // 勾选个数
                    let n = 0;
                    for(let i = 0; i < element.length - 1; i++){
                        if(element[i].checked){
                            n++;
                        }
                    }
                    // 只有一个被勾选时，不可取消
                    if(n == 1){
                        for(let i = 0; i < element.length - 1; i++){
                            if(element[i].checked){
                                element[i].disabled = true;
                            }
                        } 
                    }
                    // 当且只有两个被勾选时，全选状态被取消，并且去除其他disabled
                    if(n == 2){
                        element[3].checked = "";
                        for(let i = 0; i < element.length - 1; i++){
                            element[i].disabled = '';
                        }
                    }
                    // 当全部单选被勾选时，全选被勾起
                    if(n == 3){
                        element[3].checked = "checked";
                    }
                }

                // 绑定点击(勾选)事件
                regionCbox[3].onclick = function(){
                    selectAll(regionCbox);
                }
                productCbox[3].onclick = function(){
                    selectAll(productCbox);
                }
                for(let i = 0; i < regionCbox.length - 1; i++){
                    regionCbox[i].onclick = function(){
                        selectOne(regionCbox);
                    }
                }
                for(let j = 0; j < productCbox.length - 1; j++){
                    productCbox[j].onclick = function(){
                        selectOne(productCbox);
                    }
                }
                
                // 监听点击（勾选）事件，显示表格
                selectDiv.addEventListener('click', function(){    
                    // 获取勾选的值
                    var productValueList = [];
                    var regionValueList = [];
                    for(let i = 0; i < productCbox.length - 1; i++){
                        if(productCbox[i].checked){
                            productValueList.push(productCbox[i].value);
                        }
                    }
                    for(let i = 0; i < regionCbox.length - 1; i++){
                        if(regionCbox[i].checked){
                            regionValueList.push(regionCbox[i].value);
                        }
                    }
                    
                    // 显示表格
                    tbody.innerHTML = "";
                    tbody.innerHTML += tbodyHTML(productValueList, regionValueList);

                    var trData = document.querySelectorAll('.trData');
                    for(let item of trData){
                        // 判断合并的标签
                        if(item.childElementCount == 14){
                            console.log(item.firstChild);
                            // 判断合并行数，并设置rowspan属性
                            if(productValueList.length > 1 && regionValueList.length == 1){
                                item.firstChild.setAttribute('rowspan', productValueList.length);
                            }
                            else{
                                item.firstChild.setAttribute('rowspan', regionValueList.length);
                            }
                        }
                    }
                });

                // 初始显示表格,初始状态一行只有一个勾选，所以不可取消
                regionCbox[0].checked = "checked";
                regionCbox[0].disabled= true;
                productCbox[0].checked = "checked";
                productCbox[0].disabled = true;
                tbody.innerHTML += tbodyHTML([sourceData[0].product], [sourceData[0].region]);

            }
        </script>
    </head>
    <body>
        <div id='selectDiv'>
            <div id="product-select"  >商品：
                <input type="checkbox" value="手机">手机
                <input type="checkbox" value="笔记本">笔记本
                <input type="checkbox" value="智能音箱">智能音箱
                <input type="checkbox" value="全选">全选
            </div>
            <div id="region-select">地区：
                <input type="checkbox" value="华东">华东
                <input type="checkbox" value="华南">华南
                <input type="checkbox" value="华北">华北
                <input type="checkbox" value="全选">全选
            </div>
        </div>
        <table  border="1" >
            <tbody>
                
            </tbody>
        </table>
            <!--
        
        <select id="region-select">
            <option>华东</option>
            <option>华南</option>
            <option>华北</option>
            <input type="checkbox">全选
        </select>
        <select id="product-select" >
            <option>手机</option>
            <option>笔记本</option>
            <option>智能音箱</option>
        </select>
            -->
        
    </body>
</html>